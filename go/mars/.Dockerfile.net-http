FROM golang:1.21

WORKDIR /go/src/app


ENV CGO_ENABLED=0
ENV GOOS=linux
ENV GOARCH=amd64

  COPY 'go.mod' 'go.mod'
  COPY 'main.go' 'main.go'
  COPY 'routes.conf' 'routes.conf'

  RUN go get github.com/roblillack/mars/cmd/mars-gen
  RUN go generate main.go

RUN go get
RUN go build -a -ldflags '-extldflags "-static"'  -o /go/bin/app ./


FROM debian:stable

WORKDIR /go/bin


COPY --from=0 /go/bin/app /go/bin/app

  COPY 'routes.conf' 'routes.conf'

CMD /go/bin/app
