FROM golang:1.21

WORKDIR /go/src/app


ENV CGO_ENABLED=0
ENV GOOS=linux
ENV GOARCH=amd64

  COPY 'server.go' 'server.go'
  COPY 'main.go' 'main.go'
  COPY 'go.mod' 'go.mod'


RUN go get
RUN go build -a -ldflags '-extldflags "-static"'  -o /go/bin/app ./


FROM debian:stable

WORKDIR /go/bin


COPY --from=0 /go/bin/app /go/bin/app

  COPY 'application.yml' 'application.yml'

CMD /go/bin/app
