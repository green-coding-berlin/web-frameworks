FROM node:21-slim

WORKDIR /usr/src/app

RUN apt-get -qq update

  COPY 'config' 'config'
  COPY '.sailsrc' '.sailsrc'
  COPY 'api' 'api'
  COPY 'app.js' 'app.js'
  COPY 'package.json' 'package.json'


  RUN npm --location=global install pm2
  RUN npm install

  ENV NODE_ENV=production


CMD pm2-runtime start app.js -i $(nproc)
