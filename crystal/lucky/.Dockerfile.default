FROM crystallang/crystal:1.10

WORKDIR /usr/src/app

  COPY 'config/setup.cr' 'config/setup.cr'
  COPY 'src/lucky.cr' 'src/lucky.cr'
  COPY 'src/actions/api_action.cr' 'src/actions/api_action.cr'
  COPY 'shard.yml' 'shard.yml'

RUN apt-get -qq update


RUN shards lock
RUN shards install --production
RUN shards build --release --no-debug --static

FROM debian:stable-slim

WORKDIR /usr/bin

COPY --from=0 /usr/src/app/bin/server /usr/bin/app


  ENV LUCKY_ENV=production

CMD /usr/bin/app
