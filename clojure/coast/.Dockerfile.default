
  FROM clojure:temurin-21-tools-deps-jammy

WORKDIR /usr/src/app

  COPY 'src/main/clojure/server.clj' 'src/main/clojure/server.clj'
  COPY 'deps.edn' 'deps.edn'

  RUN mkdir classes && clj -e "(compile 'server)" && clojure -Auberjar --main-class server


FROM eclipse-temurin:21.0.1_12-jre

WORKDIR /opt/bin

  ENV COAST_ENV=prod

  COPY --from=0 /usr/src/app/coast.jar /opt/bin/coast.jar 

  CMD java -jar coast.jar 3000
