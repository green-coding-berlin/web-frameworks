FROM ruby:3.3-slim

WORKDIR /usr/src/app

RUN apt-get -qq update

RUN apt-get -qy install build-essential

  COPY 'app.rb' 'app.rb'
  COPY 'Gemfile' 'Gemfile'

  ENV RACK_ENV=production
  ENV BUNDLE_WITHOUT=development,test
  ENV AGOO_WORKER_COUNT=$(nproc)

RUN bundle install


CMD bundler exec ruby app.rb